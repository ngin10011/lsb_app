<!-- tb_new.html-->
{% extends 'base.html' %}

{% block title %}New TB{% endblock %}

{% block body %}
<h1 class="h4">TB anlegen</h1>

<form method="post" novalidate>
  {{ form.hidden_tag() }}

  <div>
    <p class="text-warning">Auftragsnummer</p>
  </div>

  <div class="card mb-4">
    <div class="card-body">

      <h2 class="h6 mb-3">Patient</h2>

      <div class="mb-2">
          {{ form.name.label(class="form-label") }}
          {{ form.name(class="form-control") }}
          {% for e in form.name.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
      </div>

      <div class="mb-2">
          {{ form.geburtsname.label(class="form-label") }}
          {{ form.geburtsname(class="form-control") }}
          {% for e in form.geburtsname.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
      </div>

      <div class="mb-2">
          {{ form.vorname.label(class="form-label") }}
          {{ form.vorname(class="form-control") }}
          {% for e in form.vorname.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
      </div>


      <div class="mb-2">
          {{ form.geburtsdatum.label(class="form-label") }}
          {{ form.geburtsdatum(class="form-control", type="date") }}
          {% for e in form.geburtsdatum.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
      </div>

      <div class="mb-2">
          {{ form.geschlecht.label(class="form-label") }}
          {{ form.geschlecht(class="form-select") }}
          {% for e in form.geschlecht.errors %}<div class="text-danger">{{ e }}</div>{% endfor %}
      </div>

      <div class="card mb-4">
        <div class="card-body">
          <h2 class="h6 mb-3">Meldeadresse</h2>

          <div class="mb-3">
            {{ form.meldeadresse_id.label(class="form-label") }}
            {{ form.meldeadresse_id(class="form-select", id="sel-meldeadresse") }}
          </div>

          <div id="new-address-fields" class="border rounded p-3" style="display:none;">
            <div class="row g-2">
              <div class="col-md-9">
                {{ form.new_strasse.label(class="form-label") }}
                {{ form.new_strasse(class="form-control") }}
              </div>
              <div class="col-md-3">
                {{ form.new_hausnummer.label(class="form-label") }}
                {{ form.new_hausnummer(class="form-control") }}
              </div>
            </div>
            <div class="row g-2 mt-2">
              <div class="col-md-4">
                {{ form.new_plz.label(class="form-label") }}
                {{ form.new_plz(class="form-control") }}
              </div>
              <div class="col-md-8">
                {{ form.new_ort.label(class="form-label") }}
                {{ form.new_ort(class="form-control") }}
              </div>
            </div>
            <div class="form-text mt-2">Bitte alle Felder ausfüllen, wenn du eine neue Adresse anlegst.</div>
          </div>

          {% if error %}
            <div class="text-danger mt-2">{{ error }}</div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

  <hr>
  <div>

    <h6>Auftrag</h6>

  <div>
    <p class="text-warning">Auftragsadresse (Checkbox selbe Meldeadresse)
        ansonsten Dropdown?
    </p>
  </div>

  <div>
    <p class="text-warning">Auftragsdatum</p>
  </div>

  <div>
    <p class="text-warning">Auftragsuhrzeit</p>
  </div>

  <div>
    <p class="text-warning">Kostenstelle (vielleicht ans Ende nach den
        anderen Kategorien?)
    </p>
  </div>

  <hr>
  <div>
    <h6>Angehörige</h6>
  </div>

  <hr>
  <div>
    <h6>Bestattungsinstitut</h6>
  </div>

  <hr>
  <div>
    <h6>Behörden</h6>
  </div>

  <hr>
  <div>
    <h6>Bemerkung (in DB tblAuftrag speichern?)</h6>
  </div>


  </div>

  {{ form.submit(class="btn btn-primary") }}
</form>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const sel = document.getElementById('sel-meldeadresse');
  const box = document.getElementById('new-address-fields');
  function toggleNew() {
    box.style.display = (parseInt(sel.value, 10) === -1) ? 'block' : 'none';
  }
  sel.addEventListener('change', toggleNew);
  toggleNew(); // initial
});
</script>

{% endblock %}
