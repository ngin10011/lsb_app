<!-- lsb_app/templates/home.html -->
{% extends "base.html" %}

{% block title %}Startseite{% endblock %}

{% block body %}
<div class="container py-4">

  <h1 class="h4 mb-4">Willkommen in der Auftragsverwaltung</h1>

  <div class="row g-3 mb-4">

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('tb.new') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center py-4">
            <div class="fs-1">ğŸ“</div>
            <div class="fw-semibold mt-2">Neue TB</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="#" class="text-decoration-none">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center py-4">
            <div class="fs-1">ğŸ“„</div>
            <div class="fw-semibold mt-2">TB Ãœbersicht</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('patients.overview') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100">
          <div class="card-body text-center py-4">
            <div class="fs-1">ğŸ‘¤</div>
            <div class="fw-semibold mt-2">Patienten</div>
          </div>
        </div>
      </a>
    </div>

    {% if vm.debug %}
    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('debug.db_overview') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100 border-danger">
          <div class="card-body text-center py-4">
            <div class="fs-1">ğŸ› </div>
            <div class="fw-semibold mt-2 text-danger">Debug DB</div>
          </div>
        </div>
      </a>
    </div>
    {% endif %}

  </div>

  <hr class="my-4">

  <div class="row g-3 mb-4">

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('rechnungen.send_batch_email') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100 {{ 'border-zero card-zero' if vm.ready_email_is_zero else '' }}">
          <div class="card-body text-center py-4">
            <div class="fs-4 mb-1">ğŸ“§ READY</div>
            <div class="display-6">{{ vm.ready_email_count }}</div>
            <div class="fw-semibold mt-2">Rechnungen zum Verschicken per E-Mail</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="#" class="text-decoration-none">
        <div class="card shadow-sm h-100 {{ 'border-zero card-zero' if vm.print_is_zero else '' }}">
          <div class="card-body text-center py-4">
            <div class="fs-4 mb-1">ğŸ–¨ PRINT</div>
            <div class="display-6">{{ vm.print_count }}</div>
            <div class="fw-semibold mt-2">Rechnungen zum Ausdrucken</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('auftraege.todo_list') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100 {{ 'border-zero card-zero' if vm.todo_is_zero else '' }}">
          <div class="card-body text-center py-4">
            <div class="fs-4 mb-1">ğŸ“Œ TODO</div>
            <div class="display-6">{{ vm.todo_count }}</div>
            <div class="fw-semibold mt-2">AuftrÃ¤ge zu bearbeiten</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('rechnungen.send_inquiry') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100 {{ 'border-zero card-zero' if vm.inquiry_is_zero else '' }}">
          <div class="card-body text-center py-4">
            <div class="fs-4 mb-1">â“ INQUIRY</div>
            <div class="display-6">{{ vm.inquiry_count }}</div>
            <div class="fw-semibold mt-2">Anfragen zu stellen</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('auftraege.wait_list') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100 {{ 'border-zero card-zero' if vm.wait_overdue_is_zero else '' }}">
          <div class="card-body text-center py-4">
            <div class="fs-4 mb-1">â³ WAIT</div>
            <div class="display-6">{{ vm.wait_overdue_count }}</div>
            <div class="fw-semibold mt-2">AuftrÃ¤ge mit ausstehender RÃ¼ckmeldung</div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-lg-3">
      <a href="{{ url_for('auftraege.overdue_list') }}" class="text-decoration-none">
        <div class="card shadow-sm h-100 {{ 'border-zero card-zero' if vm.overdue_is_zero else '' }}">
          <div class="card-body text-center py-4">
            <div class="fs-4 mb-1">âš ï¸ OVERDUE</div>
            <div class="display-6">{{ vm.overdue_count }}</div>
            <div class="fw-semibold mt-2">Rechnungen &gt; 30 Tage seit Versand</div>
          </div>
        </div>
      </a>
    </div>



  </div>

  <h2 class="h6 mb-3">Letzte AuftrÃ¤ge</h2>
  <table class="table table-sm align-middle">
    <thead>
      <tr>
        <th>#</th>
        <th>Patient</th>
        <th>Datum</th>
        <th>Status</th>
        <th class="text-end"></th>
      </tr>
    </thead>
    <tbody>
      {% for a in vm.recent_auftraege %}
      <tr>
        <td>{{ a.id }}</td>
        <td>{{ a.patient.name }}, {{ a.patient.vorname }}</td>
        <td>{{ a.auftragsdatum.strftime('%d.%m.%Y') if a.auftragsdatum else 'â€”' }}</td>
        <td>{{ a.status.value if a.status else 'â€”' }}</td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-secondary"
             href="{{ url_for('patients.detail', pid=a.patient.id) }}">
            Details
          </a>
        </td>
      </tr>
      {% endfor %}

      {% if not vm.recent_auftraege %}
      <tr>
        <td colspan="5" class="text-center text-muted">
          Keine Daten vorhanden
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>

</div>
{% endblock %}
