{# lsb_app/templates/auftraege/overdue.html #}
{% extends "base.html" %}
{% block title %}Overdue{% endblock %}

{% block body %}
{% macro show(v) -%}
  {%- if v is none -%}—{%- elif v.value is defined and v.name is defined -%}{{ v.value }}{%- else -%}{{ v }}{%- endif -%}
{%- endmacro %}

<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Overdue-Aufträge</h1>
    <div class="text-muted small">
      Kriterium: gesendet bis inkl. {{ cutoff.date().strftime('%d.%m.%Y') }}
    </div>
  </div>

  <table class="table table-sm align-middle">
    <thead>
      <tr>
        <th>Auftrag</th>
        <th>Patient</th>
        <th>Rechnung v</th>
        <th>Kostenstelle</th>
        <th>Gesendet</th>
        <th class="text-end">Überfällig seit</th>
        <th class="text-end"></th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ "%04d"|format(it.auftrag.auftragsnummer) }}</td>
        <td>{{ it.auftrag.patient.name }}, {{ it.auftrag.patient.vorname }}</td>
        <td>{{ it.rechnung.version }}</td>
        <td>{{ show(it.auftrag.kostenstelle) }}</td>
        <td>{{ it.rechnung.gesendet_datum.strftime('%d.%m.%Y') }}</td>
        <td class="text-end">
          {{ it.overdue_days }} Tage
        </td>
        <td class="text-end">
          <a class="btn btn-sm btn-outline-secondary"
             href="{{ url_for('patients.detail', pid=it.auftrag.patient.id) }}">
            Details
          </a>
        </td>
      </tr>
      {% endfor %}

      {% if not items %}
      <tr>
        <td colspan="6" class="text-center text-muted">Keine überfälligen Rechnungen</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

</div>
{% endblock %}
